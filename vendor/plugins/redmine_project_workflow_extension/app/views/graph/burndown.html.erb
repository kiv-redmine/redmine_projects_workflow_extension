<% html_title(l(:label_charts_menu)) -%>

<% content_for :sidebar do %>
  <%= render 'sidebar' %>
<% end %>

<h2><%= l(:label_burndown_chart) %></h2>

<script type="text/javascript">
var chart;
document.observe('dom:loaded', function(){
    var $tooltip = $('tooltip');
    $tooltip.hide();
    var $text = $('tooltiptext');
    displayTooltip = function (text, left) {
        $text.innerText = text;
        $tooltip.show();
        $tooltip.attributes['style'].value = 'left: ' + parseInt(left)  + 'px';
    };
    var timer;
    hideTooltip = function (e) {
        clearTimeout(timer);
        timer = setTimeout(function () {
            $tooltip.hide();
        }, 2500);
    };

    function hideAll() {
      <%= print_remove_plot_bands("chart", @milestones) %>
      <%= print_remove_plot_bands("chart", @versions) %>
      <%= print_remove_plot_bands("chart", @iterations) %>
    }

    /** Observe check boxes for displaying / hiding project versions */
    $$(".chart_options input").each(function(e) {
      $(e.id).observe('click', function(e) {
        hideAll();
        if (this.checked) {
          /* Display milestones|versions|iterations */
          switch (this.id) {
            case "show_milestones":
            <%= print_create_plot_bands("chart", @milestones) %>
            break;

            case "show_iterations":
            <%= print_create_plot_bands("chart", @iterations) %>
            break;

            case "show_versions":
            <%= print_create_plot_bands("chart", @versions) %>
            break;
          }
        }
      });
    });

/* Create char */
chart = new Highcharts.Chart({
  chart: {
    renderTo: 'container'
  },
  title: {
    text: ''
  },
  legend: {
    layout: 'vertical',
    align: 'right',
    verticalAlign: 'middle',
    borderWidth: 0
  },
  xAxis: {
    title: {
      text: 'Datumy'
    },
    tickPixelInterval: 100,
    type: 'datetime'
  },
  yAxis: {
    title: {
        text: 'Hodiny'
    }
  },
  series: [
          { name: "Odhadovana doba", data: [ <%= print_chart_line(@ideal_line) %> ] },
          { name: "Skutecna doba", data: [ <%= print_records(@current_line) %> ]}
        ]
  });
});
</script>
  <style type="text/css">
    .thetooltip {
        border: 1px solid #2f7ed8;
        background-color: #fff;
        opacity: 0.8500000000000001;
        padding: 4px 12px;
        border-radius: 3px;
        position: absolute;
        top:100px;
        box-shadow: 1px 1px 3px #666;
        z-index: 1000;
    }
  </style>
<div id="burndown_chart" class="box" style="position: relative;">
  <div id="tooltip" class="thetooltip">
      <p id="tooltiptext" style="margin:0">default</p>
  </div>
  <div class="chart_options" style="width: 100%; text-align: center;">
    <strong><%= l(:label_show_project_attributes) %>:</strong>&nbsp;
    <label>
      <input type="radio" name="show" id="show_milestones" />
      <%= l(:label_milestone_plural) %>
    </label>
    <label>
      <input type="radio" name="show" id="show_versions" />
      <%= l(:label_version_plural) %>
    </label>
    <label>
      <input type="radio" name="show" id="show_iterations" />
      <%= l(:label_iteration_plural) %>
    </label>
    <label>
      <input type="radio" name="show" id="hide_all" checked="checked" />
      <%= l(:label_hide_all_attributes) %>
    </label>
  </div>
  <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto; z-index: 1;"></div>
</div>
